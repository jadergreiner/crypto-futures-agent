name: ğŸ”„ Dashboard Auto-Sync

# Disparar quando hÃ¡ mudanÃ§as em documentaÃ§Ã£o
on:
  push:
    paths:
      - 'docs/**/*.md'
      - 'STATUS_ATUAL.md'
      - 'DECISIONS.md'
      - 'README.md'
  workflow_dispatch:  # Permitir disparo manual

jobs:
  sync-dashboard:
    runs-on: ubuntu-latest
    name: Sincronizar Dashboard de Projeto

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ”„ Executar sincronizaÃ§Ã£o de dashboard
        run: |
          echo "ğŸ”„ Iniciando sincronizaÃ§Ã£o automÃ¡tica do dashboard..."
          python update_dashboard.py
          echo "âœ… SincronizaÃ§Ã£o concluÃ­da!"

      - name: ğŸ” Validar JSON
        run: |
          echo "ğŸ” Validando integridade do dashboard_data.json..."
          python -m json.tool dashboard_data.json > /dev/null
          echo "âœ… JSON vÃ¡lido!"

      - name: ğŸ“ Commit automÃ¡tico
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action [Dashboard]"

          # Verificar se hÃ¡ mudanÃ§as
          if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“ Commitando mudanÃ§as do dashboard..."
            git add dashboard_data.json
            git commit -m "[SYNC] Dashboard sincronizado automaticamente

            - Fonte: MudanÃ§as em documentaÃ§Ã£o (STATUS_ATUAL.md, DECISIONS.md)
            - Timestamp: $(date -u +'%Y-%m-%dT%H:%M:%SZ')
            - Triggered by: ${{ github.event_name }}
            - Equipe: Doc Advocate ativo"
            echo "âœ… Commit realizado com sucesso!"
          else
            echo "â„¹ï¸  Nenhuma mudanÃ§a detectada no dashboard"
          fi

      - name: ğŸš€ Push das mudanÃ§as
        if: success()
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}

      - name: ğŸ“Š Log de sincronizaÃ§Ã£o
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š DASHBOARD SYNC REPORT"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "VersÃ£o: $(jq -r '.project.version' dashboard_data.json)"
          echo "Status: $(jq -r '.project.status' dashboard_data.json)"
          echo "Atualizado: $(jq -r '.project.updated' dashboard_data.json)"
          echo "Membros equipe: $(jq '.team | length' dashboard_data.json)"
          echo "Milestones: $(jq '.milestones | length' dashboard_data.json)"
          echo "DecisÃµes: $(jq '.decisions | length' dashboard_data.json)"
          echo "Bloqueadores: $(jq '.blockers | length' dashboard_data.json)"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
